---
version: 1

kind: experiment

framework: pytorch

tags: [tests, simclr, liver_reduced, lr-scheduler, pretrained-weights]

build:
  image: pytorchlightning/pytorch_lightning:base-xla-py3.7-torch1.12
  build_steps:
    - pip install -r requirements.txt
    - pip install markupsafe==2.0.1 --force
    - pip3 install torch_xla[tpuvm]
    - pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu117

environment:
  resources:
    cpu:
      requests: 4
      limits: 32
    memory:
      requests: 16384
      limits: 32768
    gpu:
      requests: 1
      limits: 1

run:
  cmd: python -m tasks.train \
                wandb.setup.project=self-train \
                dataset=liver_reduced \
                experiment.name=train_simclr \
                train=simclr \
                train.epochs=1000 \
                train.pretrained_weights=True \
                loader.batch_size=128 \
                loader.num_workers=8 \
                wandb=server

