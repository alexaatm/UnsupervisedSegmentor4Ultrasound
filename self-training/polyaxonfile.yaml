---
version: 1

kind: experiment

framework: pytorch

tags: [tests]

build:
  image: pytorchlightning/pytorch_lightning:base-xla-py3.7-torch1.12
  build_steps:
    - pip install -r requirements.txt
    - pip install markupsafe==2.0.1 --force
    - pip3 install torch_xla[tpuvm]
    - pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu117

environment:
  resources:
    cpu:
      requests: 6
      limits: 12
    memory:
      requests: 8192
      limits: 16384
    gpu:
      requests: 1
      limits: 1

run:
  cmd: python -m tasks.train_polyaxon \
                wandb.setup.project=self-train-test \
                dataset=liver2_mini \
                experiment.name=train_simclr \
                train=simclr \
                train.epochs=2 \
                loader.batch_size=1 \
                loader.num_workers=8 \
                wandb=server

